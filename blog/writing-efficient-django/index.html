<!DOCTYPE html>
<html lang="en-us">

    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Victoria Drake, Director of Engineering, is building better cybersecurity and happy and productive technical teams.">
<title>
    Writing efficient Django | victoria.dev
</title>



        <script async defer data-domain="victoria.dev" src="https://p.victoria.dev/js/index.js"></script>

        <meta
  name="monetization"
  content="$ilp.uphold.com/pBRfRwg2EJAe">

        <meta property="og:title" content="Writing efficient Django - victoria.dev" />
<meta property="og:type" content="website" />
<meta property="og:description"
    content="How to use Django&#39;s views, models, and queries to build a better application." />
<meta property="og:url" content="https://victoria.dev/blog/writing-efficient-django/" />
<meta property="og:site_name" content="victoria.dev" />


<meta property="og:image" content="https://victoria.dev/blog/writing-efficient-django/cover.png"/>


        <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Writing efficient Django" />


<meta name="twitter:image" content="https://victoria.dev/blog/writing-efficient-django/cover.png"/>

<meta name="twitter:description"
    content="How to use Django&#39;s views, models, and queries to build a better application." />

        
<link rel="shortcut icon" href="/img/favicon.ico">


        





<link rel="stylesheet" href="/css/main.min.843b58ef62818dd4d1fc9ea546e7b27090724f94463bc30fbd92e7200c32f34e.css" integrity="sha256-hDtY72KBjdTR/J6lRueycJByT5RGO8MPvZLnIAwy804=" media="screen">





        
        
        
        
    </head>

    <body>
        <header role="banner">
            
            <nav aria-label="Victoria.dev main menu" id="menu">
    <ul role="menubar">
        
        
        <li role="none" class="menu-item ">
            <a role="menuitem" href="/">
                <img src='/img/bookmark.svg' alt='home page icon' height='18px' class='filter-icon'> hi</a >
        </li>
        
        <li role="none" class="menu-item ">
            <a role="menuitem" href="/blog/">
                <img src='/img/quote.svg' alt='blog icon' height='18px' class='filter-icon'> blog</a >
        </li>
        
        <li role="none" class="menu-item ">
            <a role="menuitem" href="/about/">
                <img src='/img/profile.svg' alt='about page icon' height='18px' class='filter-icon'> about</a >
        </li>
        
        <li role="none" class="menu-item ">
            <a role="menuitem" href="/coffee/">
                <img src='/img/coffee.svg' alt='coffee icon' height='18px' class='filter-icon'> buy me coffee</a >
        </li>
        
        <li role="none" class="menu-item ">
            <a role="menuitem" href="/bookshelf/">
                <img src='/img/book.svg' alt='bookshelf icon' height='18px' class='filter-icon'> bookshelf</a >
        </li>
        
        <li role="none" class="menu-item">
            <a role="menuitem" id="rss" href="https://victoria.dev/index.xml" rel="alternate" type="application/rss+xml"
                title="RSS for Writing efficient Django" /><img src='/img/rss.svg' alt='RSS icon' height='18px' class='filter-icon'> rss</a>
        </li>
    </ul>
</nav>

            
        </header>
        <main aria-role="main">
            <div class="container">
                



<div id="cover-image">
    <img src="https://victoria.dev/blog/writing-efficient-django/cover.png" alt="cover image" />
</div>
<article>
    <h1>


        Writing efficient Django
    </h1>
    
    <p class="subtitle">How to use Django&#39;s views, models, and queries to build a better application.</p>
    
    <span>

        
        <a class="tag button" href="/tags/coding/">
            coding
        </a>&nbsp;
        
        <a class="tag button" href="/tags/python/">
            python
        </a>&nbsp;
        
        
    </span>
    <p class="metadata" id="date">
        <span>July 9, 2020</span>
        
        <span>
            <em>Updated: Dec 29, 2020</em>
        </span>
        
        <span>
             ☕️ ☕️&nbsp;6 min read
        </span>
    </p>

    
    </p>

    

    <div class="page-separator">
        <hr />
    </div>

    <div class="markdown">
        <p>I like Django. It&rsquo;s a well-considered and intuitive framework with a name I can pronounce out loud. You can use it to to quickly spin up a <a href="https://github.com/victoriadrake/react-in-django">weekend-sized project</a>, and you can still use it to run <a href="https://applybyapi.com">full-blown production applications</a> at scale. I&rsquo;ve done both these things, and over the years I&rsquo;ve discovered how to use some of Django&rsquo;s features for maximum efficiency. These are:</p>
<ul>
<li><a href="#class-based-versus-function-based-views">Class-based versus function-based views</a></li>
<li><a href="#django-models">Django models</a></li>
<li><a href="#retrieving-objects-with-queries">Retrieving objects with queries</a></li>
</ul>
<p>Let&rsquo;s look at how these tools let you create a performant Django application that&rsquo;s pleasant to build and maintain.</p>
<h2 id="class-based-versus-function-based-views" class="anchor-link"><a href="https://victoria.dev/blog/writing-efficient-django/#class-based-versus-function-based-views">Class-based versus function-based views</a></h2>
<p>Remember that Django is all Python under the hood. When it comes to views, you&rsquo;ve got two choices: <a href="https://docs.djangoproject.com/en/3.0/topics/http/views/">view functions</a> (sometimes called &ldquo;function-based views&rdquo;), or <a href="https://docs.djangoproject.com/en/3.0/topics/class-based-views/">class-based views</a>.</p>
<p>Years ago when I first built <a href="https://applybyapi.com">ApplyByAPI</a>, it was initially composed entirely of function-based views. These offer granular control, and are good for implementing complex logic; just as in a Python function, you have complete control (for better or worse) over what the view does. With great control comes great responsibility, and function-based views can be a little tedious to use. You&rsquo;re responsible for writing all the necessary methods for the view to work - this is what allows you to completely tailor your application.</p>
<p>In the case of ApplyByAPI, there were only a sparse few places where that level of tailored functionality was really necessary. Everywhere else, function-based views began making my life harder. Writing what is essentially a custom view for run-of-the-mill operations like displaying data on a list page became tedious, repetitive, and error-prone.</p>
<p>With function-based views, you&rsquo;ll need figure out which Django methods to implement in order to handle requests and pass data to views. Unit testing can take some work to write. In short, the granular control that function-based views offer also requires some granular tedium to properly implement.</p>
<p>I ended up holding back ApplyByAPI while I refactored the majority of the views into class-based views. This was not a small amount of work and refactoring, but when it was done, I had a bunch of tiny views that made a huge difference. I mean, just look at this one:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">ApplicationsList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Application</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&#34;applications.html&#34;</span>
</code></pre></div><p>It&rsquo;s three lines. My developer ergonomics, and my life, got a lot easier.</p>
<p>You may think of class-based views as templates that cover most of the functionality any app needs. There are views for displaying lists of things, for viewing a thing in detail, and <a href="https://docs.djangoproject.com/en/3.0/ref/class-based-views/generic-editing/">editing views</a> for performing CRUD (Create, Read, Update, Delete) operations. Because implementing one of these generic views takes only a few lines of code, my application logic became dramatically succinct. This gave me less repeated code, fewer places for something to go wrong, and a more manageable application in general.</p>
<p>Class-based views are fast to implement and use. The built-in class-based generic views may require less work to test, since you don&rsquo;t need to write tests for the base view Django provides. (Django does its own tests for that; no need for your app to double-check.) To tweak a generic view to your needs, you can <a href="https://docs.djangoproject.com/en/3.0/topics/class-based-views/#subclassing-generic-views">subclass a generic view</a> and override attributes or methods. In my case, since I only needed to write tests for any customizations I added, my test files became dramatically shorter, as did the time and resources it took to run them.</p>
<p>When you&rsquo;re weighing the choice between function-based or class-based views, consider the amount of customization the view needs, and the future work that will be necessary to test and maintain it. If the logic is common, you may be able to hit the ground running with a generic class-based view. If you need sufficient granularity that re-writing a base view&rsquo;s methods would make it overly complicated, consider a function-based view instead.</p>
<h2 id="django-models" class="anchor-link"><a href="https://victoria.dev/blog/writing-efficient-django/#django-models">Django models</a></h2>
<p><a href="https://docs.djangoproject.com/en/3.0/topics/db/models/">Models</a> organize your Django application&rsquo;s central concepts to help make them flexible, robust, and easy to work with. If used wisely, models are a powerful way to collate your data into a definitive source of truth.</p>
<p>Like views, Django provides some built-in model types for the convenience of implementing basic authentication, including the <a href="https://docs.djangoproject.com/en/3.0/ref/contrib/auth/">User</a> and <a href="https://docs.djangoproject.com/en/3.0/ref/contrib/auth/">Permission</a> models. For everything else, you can create a model that reflects your concept by <a href="https://docs.djangoproject.com/en/3.0/topics/db/models/#model-inheritance">inheriting from a parent Model class</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">StaffMember</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
</code></pre></div><p>When you create a custom model in Django, you subclass <a href="https://github.com/django/django/blob/master/django/db/models/base.py">Django&rsquo;s Model class</a> and take advantage of all its power. Each model you create generally maps to a database table. Each attribute is a database field. This gives you the ability to create objects to work with that humans can better understand.</p>
<p>You can make a model useful to you by defining its fields. Many <a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#model-field-types">built-in field types</a> are conveniently provided. These help Django figure out the data type, the HTML <a href="https://docs.djangoproject.com/en/3.0/ref/forms/widgets/">widget</a> to use when rendering a form, and even <a href="https://docs.djangoproject.com/en/3.0/ref/forms/validation/">form validation</a> requirements. If you need to, you can <a href="https://docs.djangoproject.com/en/3.0/howto/custom-model-fields/">write custom model fields</a>.</p>
<p>Database <a href="https://docs.djangoproject.com/en/3.0/topics/db/models/#relationships">relationships</a> can be defined using a <a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.ForeignKey">ForeignKey</a> field (many-to-one), or a <a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.ManyToManyField">ManyToManyField</a> (give you three guesses). If those don&rsquo;t suffice, there&rsquo;s also a <a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.OneToOneField">OneToOneField</a>. Together, these allow you to define relations between your models with levels of complexity limited only by your imagination. (Depending on the imagination you have, this may or may not be an advantage.)</p>
<h2 id="retrieving-objects-with-queries" class="anchor-link"><a href="https://victoria.dev/blog/writing-efficient-django/#retrieving-objects-with-queries">Retrieving objects with queries</a></h2>
<p>Use your model&rsquo;s Manager (<code>objects</code> by default) to <a href="https://docs.djangoproject.com/en/3.0/topics/db/queries/#retrieving-objects">construct a QuerySet</a>. This is a representation of objects in your database that you can refine, using methods, to retrieve specific subsets. All available methods are in the <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#django.db.models.query.QuerySet">QuerySet API</a> and can be chained together for even more fun.</p>
<div class="highlight"><pre class="chroma"><code class="language-py" data-lang="py"><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;new&#34;</span>
<span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
    <span class="n">title__startswith</span><span class="o">=</span><span class="s2">&#34;Blockchain&#34;</span>
<span class="p">)</span>
</code></pre></div><p>Some methods return new QuerySets, such as <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#filter"><code>filter()</code></a>, or <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#exclude"><code>exclude()</code></a>. Chaining these can give you powerful queries without affecting performance, as QuerySets aren&rsquo;t fetched from the database <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#when-querysets-are-evaluated">until they are evaluated</a>. Methods that evaluate a QuerySet include <code>get()</code>, <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#count"><code>count()</code></a>, <code>len()</code>, <code>list()</code>, or <code>bool()</code>.</p>
<p>Iterating over a QuerySet also evaluates it, so avoid doing so where possible to improve query performance. For instance, if you just want to know if an object is present, you can use <code>exists()</code> to avoid iterating over database objects.</p>
<p>Use <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#django.db.models.query.QuerySet.get"><code>get()</code></a> in cases where you want to retrieve a specific object. This method raises <a href="https://docs.djangoproject.com/en/3.0/ref/exceptions/#django.core.exceptions.MultipleObjectsReturned"><code>MultipleObjectsReturned</code></a> if something unexpected happens, as well as the <code>DoesNotExist</code> exception, if, take a guess.</p>
<p>If you&rsquo;d like to get an object that may not exist in the context of a user&rsquo;s request, use the convenient <a href="https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/#get-object-or-404"><code>get_object_or_404()</code></a> or <a href="https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/#get-list-or-404"><code>get_list_or_404()</code></a> which raises <a href="https://docs.djangoproject.com/en/3.0/topics/http/views/#django.http.Http404"><code>Http404</code></a> instead of <a href="https://docs.djangoproject.com/en/3.0/ref/models/instances/#django.db.models.Model.DoesNotExist"><code>DoesNotExist</code></a>. These helpful <a href="https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/">shortcuts</a> are suited to just this purpose. To create an object that doesn&rsquo;t exist, there&rsquo;s also the convenient <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#get-or-create"><code>get_or_create()</code></a>.</p>
<!-- omit in toc -->
<h2 id="efficient-essentials" class="anchor-link"><a href="https://victoria.dev/blog/writing-efficient-django/#efficient-essentials">Efficient essentials</a></h2>
<p>You&rsquo;ve now got a handle on these three essential tools for building your efficient Django application &ndash; congratulations! There&rsquo;s a lot more that Django can do for you, so stay tuned for future articles. If you&rsquo;re going to build on GitHub, you may like to set up my <a href="https://github.com/victoriadrake/django-security-check">django-security-check GitHub Action</a>. In the meantime, you&rsquo;re well on your way to building a beautiful software project.</p>

    </div>
</article>

<div id="up-container">
    <a href="#" id="up">&#709;</a>
</div>

<div class="page-separator">
    <hr />
</div>



<div class="related">
    <code class="language-sql" data-lang="sql">SELECT TOP 3 * FROM Related;</code>
    <ul role="menubar" id="article-list">
        
        

<li role="none">
    <a role="menuitem" class="article-link" href="https://victoria.dev/blog/increase-developer-confidence-with-a-great-django-test-suite/">Increase developer confidence with a great Django test suite</a>
    <p>
        How to write tests for your Django applications that boost your team, and are actually useful.
    </p>
    
    <p class="metadata">
        
        <a class="tag button" href="/tags/coding/">coding</a>
        
         ☕️
        &nbsp;5 min read
        
    </p>
    
</li>



        
        

<li role="none">
    <a role="menuitem" class="article-link" href="https://victoria.dev/blog/django-project-best-practices-to-keep-your-developers-happy/">Django project best practices to keep your developers happy</a>
    <p>
        Using Makefiles, pre-commit, and GitHub Actions to help create a happy development team.
    </p>
    
    <p class="metadata">
        
        <a class="tag button" href="/tags/python/">python</a>
        
         ☕️ ☕️
        &nbsp;6 min read
        
    </p>
    
</li>



        
        

<li role="none">
    <a role="menuitem" class="article-link" href="https://victoria.dev/blog/manipulating-data-with-django-migrations/">Manipulating data with Django migrations</a>
    <p>
        How to update Django models and manipulate existing data using migrations.
    </p>
    
    <p class="metadata">
        
        <a class="tag button" href="/tags/coding/">coding</a>
        
         ☕️
        &nbsp;5 min read
        
    </p>
    
</li>



        
    </ul>
    

    <div class="page-separator">
        <p class="back-link"><a href="/blog">
                &lt;&lt; Back to blog</a>
        </p>
    </div>
</div>

            </div>

            <footer class="container">
                





<div class="markdown bio">
    
    <figure class="profile">
    <img src="/img/victoria_headshot.jpg"
         alt="Victoria&#39;s headshot"/> 
</figure>

<p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award two years in a row from the freeCodeCamp non-profit, and is a recognized Distinguished Author on the DEV.to developer platform. She writes about software development, cybersecurity, and building happy and productive technical teams.</p>
<p><a href="/about">about</a> - <a href="mailto:hello@victoria.dev">email</a> - <a href="https://github.com/victoriadrake">github</a> - <a href="https://twitter.com/victoriadotdev">twitter</a> - <a href="https://www.linkedin.com/in/victoriadotdev/">linkedin</a></p>

</div>




            </footer>
        </main>

        
        
        
        <nav aria-label="Victoria.dev menu for mobile" id="menu-mobile">
            <ul role="menubar">
                
                
                <li role="none" class="menu-item">
                    <a role="menuitem"
                        href="/">
                        <img src='/img/bookmark.svg' alt='home page icon' height='18px' class='filter-icon'></a >
                </li>
                
                <li role="none" class="menu-item">
                    <a role="menuitem"
                        href="/blog/">
                        <img src='/img/quote.svg' alt='blog icon' height='18px' class='filter-icon'></a >
                </li>
                
                <li role="none" class="menu-item">
                    <a role="menuitem"
                        href="/about/">
                        <img src='/img/profile.svg' alt='about page icon' height='18px' class='filter-icon'></a >
                </li>
                
                <li role="none" class="menu-item">
                    <a role="menuitem"
                        href="/coffee/">
                        <img src='/img/coffee.svg' alt='coffee icon' height='18px' class='filter-icon'></a >
                </li>
                
                <li role="none" class="menu-item">
                    <a role="menuitem"
                        href="/bookshelf/">
                        <img src='/img/book.svg' alt='bookshelf icon' height='18px' class='filter-icon'></a >
                </li>
                
            </ul>
        </nav>
    </body>

</html>
