<!doctype html><html lang=en-us><head><head><meta charset=utf-8><meta name=mobile-web-app-capable content="yes"><meta name=viewport content="width=device-width,initial-scale=1"><title>victoria.dev</title><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><link rel="shortcut icon" href=https://victoria.dev/favicon.ico><link rel=icon type=image/png href=https://victoria.dev/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://victoria.dev/favicon-16x16.png sizes=16x16><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=me href=https://github.com/victoriadrake><link rel=me href=https://twitter.com/victoriadotdev><link rel=me href=https://mastodon.technology/@victoria><link rel=stylesheet href=https://victoria.dev/css/style.css crossorigin=anonymous media=screen><link rel=webmention href=https://webmention.io/victoria.dev/webmention><link rel=pingback href=https://webmention.io/victoria.dev/xmlrpc><meta property="og:url" content="https://victoria.dev/"><meta property="og:title" content="victoria.dev"><meta property="og:site_name" content="victoria.dev"><meta property="og:type" content="website"><meta name=twitter:title content="victoria.dev"></head></head><body><header role=banner><nav aria-label="Victoria.dev main menu" id=menu><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/icon/bookmark.svg alt="home page icon" height=18px class=filter-icon>&nbsp;hello</a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/icon/quote.svg alt="blog icon" height=18px class=filter-icon>&nbsp;blog</a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/icon/profile.svg alt="about page icon" height=18px class=filter-icon>&nbsp;about</a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/icon/book.svg alt="bookshelf icon" height=18px class=filter-icon>&nbsp;bookshelf</a></li></ul></nav><nav aria-label="Victoria.dev menu for mobile" id=menu-mobile><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/icon/bookmark.svg alt="home page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/icon/quote.svg alt="blog icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/icon/profile.svg alt="about page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/icon/book.svg alt="bookshelf icon" height=18px class=filter-icon></a></li></ul></nav></header><main aria-role=main><div class=container><div id=cover-image><img class=u-photo src=https://victoria.dev/blog/writing-efficient-django/cover.png alt="cover image"></div><article class=h-entry><h1 class=p-name>Writing efficient Django</h1><p class=subtitle>How to use Django's views, models, and queries to build a better application.</p><span><a class="p-category tag button" href=/tags/coding/>coding
</a>&nbsp;
<a class="p-category tag button" href=/tags/python/>python
</a>&nbsp;</span>
<span rel=author class="p-author h-card"><img class="u-photo hidden" src=/img/victoria_headshot.jpg>
<span class="p-name hidden" rel=me>Victoria Drake</span></span><p class=metadata id=date><time class="hidden dt-published">2020-07-09 04:02:47 -0500 -0500</time>
<a class=u-url href=https://victoria.dev/blog/writing-efficient-django/>July 9, 2020</a>
<span class=dt-updated>&nbsp;<em>Updated: Jun 2, 2021</em></span>
<span>&nbsp;6 min read</span></p></p><div class=page-separator><hr></div><div class="markdown e-content"><p>I like Django. It&rsquo;s a well-considered and intuitive framework with a name I can pronounce out loud. You can use it to to quickly spin up a <a href=https://github.com/victoriadrake/react-in-django>weekend-sized project</a>, and you can still use it to run <a href=https://applybyapi.com>full-blown production applications</a> at scale. I&rsquo;ve done both these things, and over the years I&rsquo;ve discovered how to use some of Django&rsquo;s features for maximum efficiency. These are:</p><ul><li><a href=#class-based-versus-function-based-views>Class-based versus function-based views</a></li><li><a href=#django-models>Django models</a></li><li><a href=#retrieving-objects-with-queries>Retrieving objects with queries</a></li></ul><p>Let&rsquo;s look at how these tools let you create a performant Django application that&rsquo;s pleasant to build and maintain.</p><h2 id=class-based-versus-function-based-views>Class-based versus function-based views</h2><p>Remember that Django is all Python under the hood. When it comes to views, you&rsquo;ve got two choices: <a href=https://docs.djangoproject.com/en/3.0/topics/http/views/>view functions</a> (sometimes called &ldquo;function-based views&rdquo;), or <a href=https://docs.djangoproject.com/en/3.0/topics/class-based-views/>class-based views</a>.</p><p>Years ago when I first built <a href=https://applybyapi.com>ApplyByAPI</a>, it was initially composed entirely of function-based views. These offer granular control, and are good for implementing complex logic; just as in a Python function, you have complete control (for better or worse) over what the view does. With great control comes great responsibility, and function-based views can be a little tedious to use. You&rsquo;re responsible for writing all the necessary methods for the view to work - this is what allows you to completely tailor your application.</p><p>In the case of ApplyByAPI, there were only a sparse few places where that level of tailored functionality was really necessary. Everywhere else, function-based views began making my life harder. Writing what is essentially a custom view for run-of-the-mill operations like displaying data on a list page became tedious, repetitive, and error-prone.</p><p>With function-based views, you&rsquo;ll need figure out which Django methods to implement in order to handle requests and pass data to views. Unit testing can take some work to write. In short, the granular control that function-based views offer also requires some granular tedium to properly implement.</p><p>I ended up holding back ApplyByAPI while I refactored the majority of the views into class-based views. This was not a small amount of work and refactoring, but when it was done, I had a bunch of tiny views that made a huge difference. I mean, just look at this one:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>ApplicationsList</span><span class=p>(</span><span class=n>ListView</span><span class=p>):</span>
    <span class=n>model</span> <span class=o>=</span> <span class=n>Application</span>
    <span class=n>template_name</span> <span class=o>=</span> <span class=s2>&#34;applications.html&#34;</span>
</code></pre></div><p>It&rsquo;s three lines. My developer ergonomics, and my life, got a lot easier.</p><p>You may think of class-based views as templates that cover most of the functionality any app needs. There are views for displaying lists of things, for viewing a thing in detail, and <a href=https://docs.djangoproject.com/en/3.0/ref/class-based-views/generic-editing/>editing views</a> for performing CRUD (Create, Read, Update, Delete) operations. Because implementing one of these generic views takes only a few lines of code, my application logic became dramatically succinct. This gave me less repeated code, fewer places for something to go wrong, and a more manageable application in general.</p><p>Class-based views are fast to implement and use. The built-in class-based generic views may require less work to test, since you don&rsquo;t need to write tests for the base view Django provides. (Django does its own tests for that; no need for your app to double-check.) To tweak a generic view to your needs, you can <a href=https://docs.djangoproject.com/en/3.0/topics/class-based-views/#subclassing-generic-views>subclass a generic view</a> and override attributes or methods. In my case, since I only needed to write tests for any customizations I added, my test files became dramatically shorter, as did the time and resources it took to run them.</p><p>When you&rsquo;re weighing the choice between function-based or class-based views, consider the amount of customization the view needs, and the future work that will be necessary to test and maintain it. If the logic is common, you may be able to hit the ground running with a generic class-based view. If you need sufficient granularity that re-writing a base view&rsquo;s methods would make it overly complicated, consider a function-based view instead.</p><h2 id=django-models>Django models</h2><p><a href=https://docs.djangoproject.com/en/3.0/topics/db/models/>Models</a> organize your Django application&rsquo;s central concepts to help make them flexible, robust, and easy to work with. If used wisely, models are a powerful way to collate your data into a definitive source of truth.</p><p>Like views, Django provides some built-in model types for the convenience of implementing basic authentication, including the <a href=https://docs.djangoproject.com/en/3.0/ref/contrib/auth/>User</a> and <a href=https://docs.djangoproject.com/en/3.0/ref/contrib/auth/>Permission</a> models. For everything else, you can create a model that reflects your concept by <a href=https://docs.djangoproject.com/en/3.0/topics/db/models/#model-inheritance>inheriting from a parent Model class</a>.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>StaffMember</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>user</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>OneToOneField</span><span class=p>(</span><span class=n>User</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>
    <span class=n>company</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>OneToOneField</span><span class=p>(</span><span class=n>Company</span><span class=p>,</span> <span class=n>on_delete</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>CASCADE</span><span class=p>)</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>company</span><span class=o>.</span><span class=n>name</span> <span class=o>+</span> <span class=s2>&#34; - &#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=o>.</span><span class=n>email</span>
</code></pre></div><p>When you create a custom model in Django, you subclass <a href=https://github.com/django/django/blob/master/django/db/models/base.py>Django&rsquo;s Model class</a> and take advantage of all its power. Each model you create generally maps to a database table. Each attribute is a database field. This gives you the ability to create objects to work with that humans can better understand.</p><p>You can make a model useful to you by defining its fields. Many <a href=https://docs.djangoproject.com/en/3.0/ref/models/fields/#model-field-types>built-in field types</a> are conveniently provided. These help Django figure out the data type, the HTML <a href=https://docs.djangoproject.com/en/3.0/ref/forms/widgets/>widget</a> to use when rendering a form, and even <a href=https://docs.djangoproject.com/en/3.0/ref/forms/validation/>form validation</a> requirements. If you need to, you can <a href=https://docs.djangoproject.com/en/3.0/howto/custom-model-fields/>write custom model fields</a>.</p><p>Database <a href=https://docs.djangoproject.com/en/3.0/topics/db/models/#relationships>relationships</a> can be defined using a <a href=https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.ForeignKey>ForeignKey</a> field (many-to-one), or a <a href=https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.ManyToManyField>ManyToManyField</a> (give you three guesses). If those don&rsquo;t suffice, there&rsquo;s also a <a href=https://docs.djangoproject.com/en/3.0/ref/models/fields/#django.db.models.OneToOneField>OneToOneField</a>. Together, these allow you to define relations between your models with levels of complexity limited only by your imagination. (Depending on the imagination you have, this may or may not be an advantage.)</p><h2 id=retrieving-objects-with-queries>Retrieving objects with queries</h2><p>Use your model&rsquo;s Manager (<code>objects</code> by default) to <a href=https://docs.djangoproject.com/en/3.0/topics/db/queries/#retrieving-objects>construct a QuerySet</a>. This is a representation of objects in your database that you can refine, using methods, to retrieve specific subsets. All available methods are in the <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#django.db.models.query.QuerySet>QuerySet API</a> and can be chained together for even more fun.</p><div class=highlight><pre class=chroma><code class=language-py data-lang=py><span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
    <span class=nb>type</span><span class=o>=</span><span class=s2>&#34;new&#34;</span>
<span class=p>)</span><span class=o>.</span><span class=n>exclude</span><span class=p>(</span>
    <span class=n>title__startswith</span><span class=o>=</span><span class=s2>&#34;Blockchain&#34;</span>
<span class=p>)</span>
</code></pre></div><p>Some methods return new QuerySets, such as <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#filter><code>filter()</code></a>, or <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#exclude><code>exclude()</code></a>. Chaining these can give you powerful queries without affecting performance, as QuerySets aren&rsquo;t fetched from the database <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#when-querysets-are-evaluated>until they are evaluated</a>. Methods that evaluate a QuerySet include <code>get()</code>, <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#count><code>count()</code></a>, <code>len()</code>, <code>list()</code>, or <code>bool()</code>.</p><p>Iterating over a QuerySet also evaluates it, so avoid doing so where possible to improve query performance. For instance, if you just want to know if an object is present, you can use <code>exists()</code> to avoid iterating over database objects.</p><p>Use <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#django.db.models.query.QuerySet.get><code>get()</code></a> in cases where you want to retrieve a specific object. This method raises <a href=https://docs.djangoproject.com/en/3.0/ref/exceptions/#django.core.exceptions.MultipleObjectsReturned><code>MultipleObjectsReturned</code></a> if something unexpected happens, as well as the <code>DoesNotExist</code> exception, if, take a guess.</p><p>If you&rsquo;d like to get an object that may not exist in the context of a user&rsquo;s request, use the convenient <a href=https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/#get-object-or-404><code>get_object_or_404()</code></a> or <a href=https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/#get-list-or-404><code>get_list_or_404()</code></a> which raises <a href=https://docs.djangoproject.com/en/3.0/topics/http/views/#django.http.Http404><code>Http404</code></a> instead of <a href=https://docs.djangoproject.com/en/3.0/ref/models/instances/#django.db.models.Model.DoesNotExist><code>DoesNotExist</code></a>. These helpful <a href=https://docs.djangoproject.com/en/3.0/topics/http/shortcuts/>shortcuts</a> are suited to just this purpose. To create an object that doesn&rsquo;t exist, there&rsquo;s also the convenient <a href=https://docs.djangoproject.com/en/3.0/ref/models/querysets/#get-or-create><code>get_or_create()</code></a>.</p><h2 id=efficient-essentials>Efficient essentials</h2><p>You&rsquo;ve now got a handle on these three essential tools for building your efficient Django application &ndash; congratulations! There&rsquo;s a lot more that Django can do for you, so stay tuned for future articles. If you&rsquo;re going to build on GitHub, you may like to set up my <a href=https://github.com/victoriadrake/django-security-check>django-security-check GitHub Action</a>. In the meantime, you&rsquo;re well on your way to building a beautiful software project.</p></div><a class=hidden href=https://brid.gy/publish/twitter></a><a class=hidden href=https://brid.gy/publish/mastodon></a><data class=p-bridgy-omit-link value=false></data></article><div id=up-container><a href=# id=up>v</a></div><hr><div id=webmentions></div><div class=related><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code><ul role=menubar id=article-list><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/increase-developer-confidence-with-a-great-django-test-suite/>Increase developer confidence with a great Django test suite</a><p class="p-summary e-content">How to write tests for your Django applications that boost your team, and are actually useful.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/coding/>coding</a>
&nbsp;5 min read
<time class="hidden dt-published">2020-10-01 05:50:37 -0400 -0400</time></p></li><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/django-project-best-practices-to-keep-your-developers-happy/>Django project best practices to keep your developers happy</a><p class="p-summary e-content">Using Makefiles, pre-commit, and GitHub Actions to help create a happy development team.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/python/>python</a>
&nbsp;6 min read
<time class="hidden dt-published">2020-09-22 04:55:19 -0400 -0400</time></p></li><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/manipulating-data-with-django-migrations/>Manipulating data with Django migrations</a><p class="p-summary e-content">How to update Django models and manipulate existing data using migrations.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/coding/>coding</a>
&nbsp;5 min read
<time class="hidden dt-published">2020-09-14 02:12:57 -0400 -0400</time></p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div></main><footer><div class="h-card row bio" rel=author><div class=markdown id=card><figure class=profile><img class=u-photo alt="Victoria Drake" src=/img/victoria_headshot.jpg></figure><h1 class=p-name>Victoria Drake</h1></address><p class=p-note><p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award three years in a row from the freeCodeCamp non-profit, and was recognized two years in a row as a Distinguished Author on the DEV.to developer platform. She writes and educates programmers and business leaders about cybersecurity, software development, and building happy and productive technical teams.</p><p><a href=/about>about</a> - <a href=/contact>contact</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></p></div></div></footer><script src=/js/webmention.min.js data-wordcount=100 async></script></body></html>