<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Victoria Drake, Director of Engineering, is building better cybersecurity and happy and productive technical teams."><title>Build your own serverless subscriber list with Go and AWS | victoria.dev</title><script async defer data-domain=victoria.dev src=https://p.victoria.dev/js/index.js></script><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><meta property="og:title" content="Build your own serverless subscriber list with Go and AWS - victoria.dev"><meta property="og:type" content="website"><meta property="og:description" content="How to build your own newsletter list with DynamoDB and SES email sign up confirmations."><meta property="og:url" content="https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/"><meta property="og:site_name" content="victoria.dev"><meta property="og:image" content="https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Build your own serverless subscriber list with Go and AWS"><meta name=twitter:image content="https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/cover.png"><meta name=twitter:description content="How to build your own newsletter list with DynamoDB and SES email sign up confirmations."><link rel="shortcut icon" href=/img/favicon.ico><link rel=stylesheet href=/css/main.min.4a986b015cfa821b6a2711f2b777dd21f509c40c5c0a052337dcd0b71e26be96.css integrity="sha256-SphrAVz6ghtqJxHyt3fdIfUJxAxcCgUjN9zQtx4mvpY=" media=screen></head><body><header role=banner><nav aria-label="Victoria.dev main menu" id=menu><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/img/bookmark.svg alt="home page icon" height=18px class=filter-icon> hi</a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/img/quote.svg alt="blog icon" height=18px class=filter-icon> blog</a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/img/profile.svg alt="about page icon" height=18px class=filter-icon> about</a></li><li role=none class=menu-item><a role=menuitem href=/coffee/><img src=/img/coffee.svg alt="coffee icon" height=18px class=filter-icon> buy me coffee</a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/img/book.svg alt="bookshelf icon" height=18px class=filter-icon> bookshelf</a></li><li role=none class=menu-item><a role=menuitem id=rss href=https://victoria.dev/index.xml rel=alternate type=application/rss+xml title="RSS for Build your own serverless subscriber list with Go and AWS"><img src=/img/rss.svg alt="RSS icon" height=18px class=filter-icon> rss</a></li></ul></nav></header><main aria-role=main><div class=container><div id=cover-image><img src=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/cover.png alt="cover image"></div><article><h1>Build your own serverless subscriber list with Go and AWS</h1><p class=subtitle>How to build your own newsletter list with DynamoDB and SES email sign up confirmations.</p><span><a class="tag button" href=/tags/api/>api
</a>&nbsp;
<a class="tag button" href=/tags/aws/>aws
</a>&nbsp;
<a class="tag button" href=/tags/coding/>coding
</a>&nbsp;
<a class="tag button" href=/tags/go/>go
</a>&nbsp;
<a class="tag button" href=/tags/data/>data
</a>&nbsp;
<a class="tag button" href=/tags/cybersecurity/>cybersecurity
</a>&nbsp;
<a class="tag button" href=/tags/websites/>websites
</a>&nbsp;</span><p class=metadata id=date><span>November 10, 2020</span>
<span><em>Updated: Dec 23, 2020</em></span>
<span>☕️ ☕️&nbsp;7 min read</span></p></p><div class=page-separator><hr></div><div class=markdown><p>You can now subscribe to my email list on <a href=/>victoria.dev</a>! Here&rsquo;s how I lovingly built a subscription sign up flow with email confirmation that doesn&rsquo;t suck. You can too.</p><h2 id=introducing-simple-subscribe class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#introducing-simple-subscribe>Introducing Simple Subscribe</a></h2><p>If you&rsquo;re interested in managing your own mailing list or newsletter, you can set up Simple Subscribe on your own AWS resources to collect email addresses. This open source API is written in Go, and runs on AWS Lambda. Visitors to your site can sign up to your list, which is stored in a DynamoDB table, ready to be queried or exported at your leisure.</p><p>When someone signs up, they&rsquo;ll receive an email asking them to confirm their subscription. This is sometimes called &ldquo;double opt-in,&rdquo; although I prefer the term &ldquo;verified.&rdquo; Simple Subscribe works on serverless infrastructure and uses an AWS Lambda to handle subscription, confirmation, and unsubscribe requests.</p><p>You can find the <a href=https://github.com/victoriadrake/simple-subscribe>Simple Subscribe project, with its fully open-source code, on GitHub</a>. I encourage you to pull up the code and follow along! In this post I&rsquo;ll share each build step, the thought process behind the API&rsquo;s single-responsibility functions, and security considerations for an AWS project like this one.</p><h2 id=building-a-verified-subscription-flow class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#building-a-verified-subscription-flow>Building a verified subscription flow</a></h2><p>A non-verified email sign up process is straightforward. Someone puts their email into a box on your website, then that email goes into your database. However, if I&rsquo;ve taught you anything about <a href=/blog/sql-injection-and-xss-what-white-hat-hackers-know-about-trusting-user-input/>not trusting user input</a>, the very idea of a non-verified sign up process should raise your hackles. Spam may be great when fried in a sandwich, but no fun when it&rsquo;s running up your AWS bill.</p><p>While you can use a strategy like a CAPTCHA or puzzle for is-it-a-human verification, these can create enough friction to turn away your potential subscribers. Instead, a confirmation email can help to ensure both address correctness and user sentience.</p><p>To build a subscription flow with email confirmation, create single-responsibility functions that satisfy each logical step. Those are:</p><ol><li>Accept an email address and record it.</li><li>Generate a token associated with that email address and record it.</li><li>Send a confirmation email to that email address with the token.</li><li>Accept a verification request that has both the email address and token.</li></ol><p>To achieve each of these goals, Simple Subscribe uses the <a href=https://docs.aws.amazon.com/sdk-for-go/api/>official AWS SDK for Go</a> to interact with DynamoDB and SES.</p><p>At each stage, consider what the data looks like and how you store it. This can help to handle conundrums like, &ldquo;What happens if someone tries to subscribe twice?&rdquo; or even <a href=/blog/if-you-want-to-build-a-treehouse-start-at-the-bottom/>threat-modeling</a> such as, &ldquo;What if someone subscribes with an email they don&rsquo;t own?&rdquo;</p><p>Ready? Let&rsquo;s break down each step and see how the magic happens.</p><h3 id=subscribing class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#subscribing>Subscribing</a></h3><p>The subscription process begins with a humble web form, like the one on my site&rsquo;s main page. A form input with attributes <code>type="email" required</code> helps with validation, <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/email#Validation>thanks to the browser</a>. When submitted, the form sends a GET request to the Simple Subscribe subscription endpoint.</p><p>Simple Subscribe receives a GET request to this endpoint with a query string containing the intended subscriber&rsquo;s email. It then generates an <code>id</code> value and adds both <code>email</code> and <code>id</code> to your DynamoDB table.</p><p>The table item now looks like:</p><table><thead><tr><th>email</th><th>confirm</th><th>id</th><th>timestamp</th></tr></thead><tbody><tr><td><code>subscriber@example.com</code></td><td><em>false</em></td><td><code>uuid-xxxxx</code></td><td>2020-11-01 00:27:39</td></tr></tbody></table><p>The <code>confirm</code> column, which holds a boolean, indicates that the item is a subscription request that has not yet been confirmed. To verify an email address in the database, you&rsquo;ll need to find the correct item and change <code>confirm</code> to <code>true</code>.</p><p>As you work with your data, consider the goal of each manipulation and how you might compare an incoming request to existing data.</p><p>For example, if someone made a subsequent subscription request for the same email address, how would you handle it? You might say, &ldquo;Create a new line item with a new <code>id</code>,&rdquo; however, this might not be best strategy when your serverless application database is paid for by request volume.</p><p>Since <a href=https://aws.amazon.com/dynamodb/pricing/>DynamoDB Pricing</a> depends on how much data you read and write to your tables, it&rsquo;s advantageous to avoid piling on excess data.</p><p>With that in mind, it would be prudent to handle subscription requests for the same email by performing an update instead of adding a new line. Simple Subscribe actually uses the same function to either add or update a database item. This is typically referred to as, &ldquo;update or insert.&rdquo;</p><p>In a database like SQLite this is accomplished with the <a href=https://www.sqlite.org/lang_UPSERT.html>UPSERT syntax</a>. In the case of DynamoDB, you use an update operation. For the <a href=https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/>Go SDK</a>, its syntax is <code>UpdateItem</code>.</p><p>When a duplicate subscription request is received, the database item is matched on the <code>email</code> only. If an existing line item is found, its <code>id</code> and <code>timestamp</code> are overridden, which updates the existing database record and avoids flooding your table with duplicate requests.</p><h3 id=verifying-email-addresses class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#verifying-email-addresses>Verifying email addresses</a></h3><p>After submitting the form, the intended subscriber then receives an email from SES containing a link. This link is built using the <code>email</code> and <code>id</code> from the table, and takes the format:</p><pre><code class=language-url data-lang=url>&lt;BASE_URL&gt;&lt;VERIFY_PATH&gt;/?email=subscriber@example.com&amp;id=uuid-xxxxx
</code></pre><p>In this set up, the <code>id</code> is a UUID that acts as a secret token. It provides an identifier that you can match that is sufficiently complex and hard to guess. This approach deters people from subscribing with email addresses they don&rsquo;t control.</p><p>Visiting the link sends a request to your verification endpoint with the <code>email</code> and <code>id</code> in the query string. This time, it&rsquo;s important to compare both the incoming <code>email</code> and <code>id</code> values to the database record. This verifies that the recipient of the confirmation email is initiating the request.</p><p>The verification endpoint ensures that these values match an item in your database, then performs another update operation to set <code>confirm</code> to <code>true</code>, and update the timestamp. The item now looks like:</p><table><thead><tr><th>email</th><th>confirm</th><th>id</th><th>timestamp</th></tr></thead><tbody><tr><td><code>subscriber@example.com</code></td><td><em>true</em></td><td><code>uuid-xxxxx</code></td><td>2020-11-01 00:37:39</td></tr></tbody></table><h3 id=querying-for-emails class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#querying-for-emails>Querying for emails</a></h3><p>You can now query your table to build your email list. Depending on your email sending solution, you might do this manually, with another Lambda, or even from the command line.</p><p>Since data for requested subscriptions (where <code>confirm</code> is <code>false</code>) is stored in the table alongside confirmed subscriptions, it&rsquo;s important to differentiate this data when querying for email addresses to send to. You&rsquo;ll want to ensure you only return emails where <code>confirm</code> is <code>true</code>.</p><h2 id=providing-unsubscribe-links class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#providing-unsubscribe-links>Providing unsubscribe links</a></h2><p>Similar to verifying an email address, Simple Subscribe uses <code>email</code> and <code>id</code> as arguments to the function that deletes an item from your DynamoDB table in order to unsubscribe an email address. To allow people to remove themselves from your list, you&rsquo;ll need to provide a URL in each email you send that includes their <code>email</code> and <code>id</code> as a query string to the unsubscribe endpoint. It would look something like:</p><pre><code class=language-url data-lang=url>&lt;BASE_URL&gt;&lt;UNSUBSCRIBE_PATH&gt;/?email=subscriber@example.com&amp;id=uuid-xxxxx
</code></pre><p>When the link is clicked, the query string is passed to the unsubscribe endpoint. If the provided <code>email</code> and <code>id</code> match a database item, that item will be deleted.</p><p>Proving a method for your subscribers to automatically remove themselves from your list, without any human intervention necessary, is part of an ethical and respectful philosophy towards handling the data that&rsquo;s been entrusted to you.</p><h2 id=caring-for-your-data class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#caring-for-your-data>Caring for your data</a></h2><p>Once you decide to accept other people&rsquo;s data, it becomes your responsibility to care for it. This is applicable to everything you build. For Simple Subscribe, it means maintaining the security of your database, and periodically pruning your table.</p><p>In order to avoid retaining email addresses where <code>confirm</code> is <code>false</code> past a certain time frame, it would be a good idea to set up a cleaning function that runs on a regular schedule. This can be achieved manually, with an AWS Lambda function, or using the command line.</p><p>To clean up, find database items where <code>confirm</code> is <code>false</code> and <code>timestamp</code> is older than a particular point in time. Depending on your use case and request volumes, the frequency at which you choose to clean up will vary.</p><p>Also depending on your use case, you may wish to keep backups of your data. If you are particularly concerned about data integrity, you can explore <a href=https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/backuprestore_HowItWorks.html>On-Demand Backup</a> or <a href=https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/PointInTimeRecovery.html>Point-in-Time Recovery</a> for DynamoDB.</p><h2 id=build-your-independent-subscriber-base class=anchor-link><a href=https://victoria.dev/blog/build-your-own-serverless-subscriber-list-with-go-and-aws/#build-your-independent-subscriber-base>Build your independent subscriber base</a></h2><p>Building your own subscriber list can be an empowering endeavor! Whether you intend to start a newsletter, send out notifications for new content, or want to create a community around your work, there&rsquo;s nothing more personal or direct than an email from me to you.</p><p>I encourage you to start building your subscriber base with Simple Subscribe today! Like most of my work, it&rsquo;s open source and free for your personal use. Dive into the code at <a href=https://github.com/victoriadrake/simple-subscribe>the GitHub repository</a> or learn more at <a href=https://simplesubscribe.org>SimpleSubscribe.org</a>.</p></div></article><div id=up-container><a href=# id=up>&#709;</a></div><div class=page-separator><hr></div><div class=related><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code><ul role=menubar id=article-list><li role=none><a role=menuitem class=article-link href=https://victoria.dev/blog/migrating-to-the-cloud-but-without-screwing-it-up-or-how-to-move-house/>Migrating to the cloud but without screwing it up, or how to move house</a><p>A practical guide to moving to cloud services with minimal downtime, using AWS examples.</p><p class=metadata><a class="tag button" href=/tags/aws/>aws</a>
☕️ ☕️
&nbsp;11 min read</p></li><li role=none><a role=menuitem class=article-link href=https://victoria.dev/blog/look-mom-im-a-github-action-hero/>Look mom, I'm a GitHub Action Hero</a><p>The GitHub blog interviews me for their GitHub Action Hero series.</p><p class=metadata><a class="tag button" href=/tags/ci/cd/>ci/cd</a>
☕️
&nbsp;5 min read</p></li><li role=none><a role=menuitem class=article-link href=https://victoria.dev/blog/hugo-vs-jekyll-an-epic-battle-of-static-site-generator-themes/>Hugo vs Jekyll: an epic battle of static site generator themes</a><p>A comparison of nuances of creating themes for the top two static site generators.</p><p class=metadata><a class="tag button" href=/tags/websites/>websites</a>
☕️ ☕️ ☕️
&nbsp;13 min read</p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div><footer class=container><div class="markdown bio"><figure class=profile><img src=/img/victoria_headshot.jpg alt="Victoria's headshot"></figure><p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award two years in a row from the freeCodeCamp non-profit, and is a recognized Distinguished Author on the DEV.to developer platform. She writes about software development, cybersecurity, and building happy and productive technical teams.</p><p><a href=/about>about</a> - <a href=mailto:hello@victoria.dev>email</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></div></footer></main><nav aria-label="Victoria.dev menu for mobile" id=menu-mobile><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/img/bookmark.svg alt="home page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/img/quote.svg alt="blog icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/img/profile.svg alt="about page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/coffee/><img src=/img/coffee.svg alt="coffee icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/img/book.svg alt="bookshelf icon" height=18px class=filter-icon></a></li></ul></nav></body></html>