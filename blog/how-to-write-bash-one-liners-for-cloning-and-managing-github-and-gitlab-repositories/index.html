<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Victoria Drake, Director of Engineering, is building better cybersecurity and happy and productive technical teams."><title>How to write Bash one-liners for cloning and managing GitHub and GitLab repositories | victoria.dev</title><link href=https://github.com/victoriadrake rel=me><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=webmention href=https://webmention.io/victoria.dev/webmention><link rel=pingback href=https://webmention.io/victoria.dev/xmlrpc><link rel=feed href=https://victoria.dev/neofeed><script async defer data-domain=victoria.dev src=https://p.victoria.dev/js/index.js></script><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><meta property="og:title" content="How to write Bash one-liners for cloning and managing GitHub and GitLab repositories - victoria.dev"><meta property="og:type" content="website"><meta property="og:description" content="Using xargs and awk in Bash to automate managing remote-hosted repositories."><meta property="og:url" content="https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/"><meta property="og:site_name" content="victoria.dev"><meta property="og:image" content="https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="How to write Bash one-liners for cloning and managing GitHub and GitLab repositories"><meta name=twitter:image content="https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/cover.png"><meta name=twitter:description content="Using xargs and awk in Bash to automate managing remote-hosted repositories."><link rel="shortcut icon" href=/img/favicon.ico><link rel=stylesheet href=/css/main.min.71cbc564770c1c541845a79e9a6bae6f07b737e023065df6aab4d7d48232b2d2.css integrity="sha256-ccvFZHcMHFQYRaeemmuubwe3N+AjBl32qrTX1IIystI=" media=screen></head><body><header role=banner><nav aria-label="Victoria.dev main menu" id=menu><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/img/bookmark.svg alt="home page icon" height=18px class=filter-icon> hi</a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/img/quote.svg alt="blog icon" height=18px class=filter-icon> blog</a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/img/profile.svg alt="about page icon" height=18px class=filter-icon> about</a></li><li role=none class=menu-item><a role=menuitem href=/coffee/><img src=/img/coffee.svg alt="coffee icon" height=18px class=filter-icon> buy me coffee</a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/img/book.svg alt="bookshelf icon" height=18px class=filter-icon> bookshelf</a></li><li role=none class=menu-item><a role=menuitem id=rss href=https://victoria.dev/index.xml rel=alternate type=application/rss+xml title="RSS for How to write Bash one-liners for cloning and managing GitHub and GitLab repositories"><img src=/img/rss.svg alt="RSS icon" height=18px class=filter-icon> rss</a></li></ul></nav></header><main aria-role=main><div class=container><div id=cover-image><img src=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/cover.png alt="cover image"></div><article><h1>How to write Bash one-liners for cloning and managing GitHub and GitLab repositories</h1><p class=subtitle>Using xargs and awk in Bash to automate managing remote-hosted repositories.</p><span><a class="tag button" href=/tags/terminal/>terminal
</a>&nbsp;
<a class="tag button" href=/tags/linux/>linux
</a>&nbsp;
<a class="tag button" href=/tags/git/>git
</a>&nbsp;
<a class="tag button" href=/tags/data/>data
</a>&nbsp;</span><p class=metadata id=date><time><a class="u-url dt-published" href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/>August 6, 2019</a></time>
<span class=dt-updated>&nbsp;
<em>Updated: Feb 3, 2021</em></span>
<span>☕️ ☕️&nbsp;8 min read</span></p></p><div class=page-separator><hr></div><div class="markdown e-content"><p>Few things are more satisfying to me than one elegant line of Bash that automates hours of tedious work. As part of some recent explorations into <a href=/blog/how-to-set-up-a-fresh-ubuntu-desktop-using-only-dotfiles-and-bash-scripts/>automatically re-creating my laptop with Bash scripts</a>, I wanted to find a way to easily clone my GitHub-hosted repositories to a new machine. After a bit of digging around, I wrote a one-liner that did just that. Then, in the spirit of not putting all our eggs in the same basket, I wrote another one-liner to automatically create and push to GitLab-hosted backups as well. Here they are.</p><h2 id=a-bash-one-liner-to-clone-all-your-github-repositories class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#a-bash-one-liner-to-clone-all-your-github-repositories>A Bash one-liner to clone all your GitHub repositories</a></h2><p>Caveat: you&rsquo;ll need a list of the GitHub repositories you want to clone. The good thing about that is it gives you full agency to choose just the repositories you want on your machine, instead of going in whole-hog.</p><p>You can easily clone GitHub repositories without entering your password each time by using HTTPS with your <a href=https://help.github.com/en/articles/caching-your-github-password-in-git>15-minute cached credentials</a> or, my preferred method, by <a href=https://help.github.com/en/articles/connecting-to-github-with-ssh>connecting to GitHub with SSH</a>. For brevity I&rsquo;ll assume we&rsquo;re going with the latter, and our SSH keys are set up.</p><p>Given a list of GitHub URLs in the file <code>gh-repos.txt</code>, like this:</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>git@github.com:username/first-repository.git
git@github.com:username/second-repository.git
git@github.com:username/third-repository.git
</code></pre></div><p>We run:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>xargs -n1 git clone &lt; gh-repos.txt
</code></pre></div><p>This clones all the repositories on the list into the current folder. This same one-liner works for GitLab repositories as well, if you substitute the appropriate URLs.</p><h3 id=whats-going-on-here class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#whats-going-on-here>What&rsquo;s going on here</a></h3><p>There are two halves to this one-liner: the input, counterintuitively on the right side, and the part that makes stuff happen, on the left. We could make the order of these parts more intuitive (maybe?) by writing the same command like this:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>&lt;gh-repos.txt xargs -n1 git clone
</code></pre></div><p>To run a command for each line of our input, <code>gh-repos.txt</code>, we use <code>xargs -n1</code>. The tool <code>xargs</code> reads items from input and executes any commands it finds (it will <code>echo</code> if it doesn&rsquo;t find any). By default, it assumes that items are separated by spaces; new lines also works and makes our list easier to read. The flag <code>-n1</code> tells <code>xargs</code> to use <code>1</code> argument, or in our case, one line, per command. We build our command with <code>git clone</code>, which <code>xargs</code> then executes for each line. Ta-da.</p><h2 id=a-bash-one-liner-to-create-and-push-many-repositories-on-gitlab class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#a-bash-one-liner-to-create-and-push-many-repositories-on-gitlab>A Bash one-liner to create and push many repositories on GitLab</a></h2><p>GitLab, unlike GitHub, lets us do this nifty thing where we don&rsquo;t have to use the website to make a new repository first. We can <a href=https://gitlab.com/help/gitlab-basics/create-project#push-to-create-a-new-project>create a new GitLab repository from our terminal</a>. The newly created repository defaults to being set as Private, so if we want to make it Public on GitLab, we&rsquo;ll have to do that manually later.</p><p>The GitLab docs tell us to push to create a new project using <code>git push --set-upstream</code>, but I don&rsquo;t find this to be very convenient for using GitLab as a backup. As I work with my repositories in the future, I&rsquo;d like to run one command that pushes to both GitHub <em>and</em> GitLab without additional effort on my part.</p><p>To make this Bash one-liner work, we&rsquo;ll also need a list of repository URLs for GitLab (ones that don&rsquo;t exist yet). We can easily do this by copying our GitHub repository list, opening it up with Vim, and doing a <a href=https://vim.fandom.com/wiki/Search_and_replace>search-and-replace</a>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>cp gh-repos.txt gl-repos.txt
vim gl-repos.txt
:%s/<span class=se>\&lt;</span>github<span class=se>\&gt;</span>/gitlab/g
:wq
</code></pre></div><p>This produces <code>gl-repos.txt</code>, which looks like:</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt>git@gitlab.com:username/first-repository.git
git@gitlab.com:username/second-repository.git
git@gitlab.com:username/third-repository.git
</code></pre></div><p>We can create these repositories on GitLab, add the URLs as remotes, and push our code to the new repositories by running:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>awk -F<span class=s1>&#39;\/|(\.git)&#39;</span> <span class=s1>&#39;{system(&#34;cd ~/FULL/PATH/&#34; $2 &#34; &amp;&amp; git remote set-url origin --add &#34; $0 &#34; &amp;&amp; git push&#34;)}&#39;</span> gl-repos.txt
</code></pre></div><p>Hang tight and I&rsquo;ll explain it; for now, take note that <code>~/FULL/PATH/</code> should be the full path to the directory containing our GitHub repositories.</p><p>We do have to make note of a couple assumptions:</p><ol><li>The name of the directory on your local machine that contains the repository is the same as the name of the repository in the URL (this will be the case if it was cloned with the one-liner above);</li><li>Each repository is currently checked out to the branch you want pushed, ie. <code>master</code>.</li></ol><p>The one-liner could be expanded to handle these assumptions, but it is the humble opinion of the author that at that point, we really ought to be writing a Bash script.</p><h3 id=whats-going-on-here-1 class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#whats-going-on-here-1>What&rsquo;s going on here</a></h3><p>Our Bash one-liner uses each line (or URL) in the <code>gl-repos.txt</code> file as input. With <code>awk</code>, it splits off the name of the directory containing the repository on our local machine, and uses these pieces of information to build our larger command. If we were to <code>print</code> the output of <code>awk</code>, we&rsquo;d see:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/FULL/PATH/first-repository <span class=o>&amp;&amp;</span> git remote set-url origin --add git@gitlab.com:username/first-repository.git <span class=o>&amp;&amp;</span> git push
<span class=nb>cd</span> ~/FULL/PATH/second-repository <span class=o>&amp;&amp;</span> git remote set-url origin --add git@gitlab.com:username/second-repository.git <span class=o>&amp;&amp;</span> git push
<span class=nb>cd</span> ~/FULL/PATH/third-repository <span class=o>&amp;&amp;</span> git remote set-url origin --add git@gitlab.com:username/third-repository.git <span class=o>&amp;&amp;</span> git push
</code></pre></div><p>Let&rsquo;s look at how we build this command.</p><h4 id=splitting-strings-with-awk class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#splitting-strings-with-awk>Splitting strings with <code>awk</code></a></h4><p>The tool <code>awk</code> can split input based on <a href=https://www.gnu.org/software/gawk/manual/html_node/Command-Line-Field-Separator.html>field separators</a>. The default separator is a whitespace character, but we can change this by passing the <code>-F</code> flag. Besides single characters, we can also use a <a href=https://www.gnu.org/software/gawk/manual/html_node/Regexp-Field-Splitting.html#Regexp-Field-Splitting>regular expression field separator</a>. Since our repository URLs have a set format, we can grab the repository names by asking for the substring between the slash character <code>/</code> and the end of the URL, <code>.git</code>.</p><p>One way to accomplish this is with our regex <code>\/|(\.git)</code>:</p><ul><li><code>\/</code> is an escaped <code>/</code> character;</li><li><code>|</code> means &ldquo;or&rdquo;, telling awk to match either expression;</li><li><code>(\.git)</code> is the capture group at the end of our URL that matches &ldquo;.git&rdquo;, with an escaped <code>.</code> character. This is a bit of a cheat, as &ldquo;.git&rdquo; isn&rsquo;t strictly splitting anything (there&rsquo;s nothing on the other side) but it&rsquo;s an easy way for us to take this bit off.</li></ul><p>Once we&rsquo;ve told <code>awk</code> where to split, we can grab the right substring with the <a href=https://www.gnu.org/software/gawk/manual/html_node/Fields.html#index-_0024-_0028dollar-sign_0029_002c-_0024-field-operator>field operator</a>. We refer to our fields with a <code>$</code> character, then by the field&rsquo;s column number. In our example, we want the second field, <code>$2</code>. Here&rsquo;s what all the substrings look like:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>1: git@gitlab.com:username
2: first-repository
</code></pre></div><p>To use the whole string, or in our case, the whole URL, we use the field operator <code>$0</code>. To write the command, we just substitute the field operators for the repository name and URL. Running this with <code>print</code> as we&rsquo;re building it can help to make sure we&rsquo;ve got all the spaces right.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>awk -F<span class=s1>&#39;\/|(\.git)&#39;</span> <span class=s1>&#39;{print &#34;cd ~/FULL/PATH/&#34; $2 &#34; &amp;&amp; git remote set-url origin --add &#34; $0 &#34; &amp;&amp; git push&#34;}&#39;</span> gl-repos.txt
</code></pre></div><h4 id=running-the-command class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#running-the-command>Running the command</a></h4><p>We build our command inside the parenthesis of <code>system()</code>. By using this as the output of <code>awk</code>, each command will run as soon as it is built and output. The <code>system()</code> function creates a <a href=https://en.wikipedia.org/wiki/Child_process>child process</a> that executes our command, then returns once the command is completed. In plain English, this lets us perform the Git commands on each repository, one-by-one, without breaking from our main process in which <code>awk</code> is doing things with our input file. Here&rsquo;s our final command again, all put together.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>awk -F<span class=s1>&#39;\/|(\.git)&#39;</span> <span class=s1>&#39;{system(&#34;cd ~/FULL/PATH/&#34; $2 &#34; &amp;&amp; git remote set-url origin --add &#34; $0 &#34; &amp;&amp; git push&#34;)}&#39;</span> gl-repos.txt
</code></pre></div><h4 id=using-our-backups class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#using-our-backups>Using our backups</a></h4><p>By adding the GitLab URLs as remotes, we&rsquo;ve simplified the process of pushing to both externally hosted repositories. If we run <code>git remote -v</code> in one of our repository directories, we&rsquo;ll see:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>origin  git@github.com:username/first-repository.git <span class=o>(</span>fetch<span class=o>)</span>
origin  git@github.com:username/first-repository.git <span class=o>(</span>push<span class=o>)</span>
origin  git@gitlab.com:username/first-repository.git <span class=o>(</span>push<span class=o>)</span>
</code></pre></div><p>Now, simply running <code>git push</code> without arguments will push the current branch to both remote repositories.</p><p>We should also note that <code>git pull</code> will generally only try to pull from the remote repository you originally cloned from (the URL marked <code>(fetch)</code> in our example above). Pulling from multiple Git repositories at the same time is possible, but complicated, and beyond the scope of this post. Here&rsquo;s an <a href=https://astrofloyd.wordpress.com/2015/05/05/git-pushing-to-and-pulling-from-multiple-remote-locations-remote-url-and-pushurl/>explanation of pushing and pulling to multiple remotes</a> to help get you started, if you&rsquo;re curious. The <a href=https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes>Git documentation on remotes</a> may also be helpful.</p><h2 id=to-elaborate-on-the-succinctness-of-bash-one-liners class=anchor-link><a href=https://victoria.dev/blog/how-to-write-bash-one-liners-for-cloning-and-managing-github-and-gitlab-repositories/#to-elaborate-on-the-succinctness-of-bash-one-liners>To elaborate on the succinctness of Bash one-liners</a></h2><p>Bash one-liners, when understood, can be fun and handy shortcuts. At the very least, being aware of tools like <code>xargs</code> and <code>awk</code> can help to automate and alleviate a lot of tediousness in our work. However, there are some downsides.</p><p>In terms of an easy-to-understand, maintainable, and approachable tool, Bash one-liners suck. They&rsquo;re usually more complicated to write than a Bash script using <code>if</code> or <code>while</code> loops, and certainly more complicated to read. It&rsquo;s likely that when we write them, we&rsquo;ll miss a single quote or closing parenthesis somewhere; and as I hope this post demonstrates, they can take quite a bit of explaining, too. So why use them?</p><p>Imagine reading a recipe for baking a cake, step by step. You understand the methods and ingredients, and gather your supplies. Then, as you think about it, you begin to realize that if you just throw all the ingredients at the oven in precisely the right order, a cake will instantly materialize. You try it, and it works!</p><p>That would be pretty satisfying, wouldn&rsquo;t it?</p></div><a class=hidden href=https://brid.gy/publish/twitter></a><a class=hidden href=https://brid.gy/publish/mastodon></a><data class=p-bridgy-omit-link value=false></data></article><div id=up-container><a href=# id=up>&#709;</a></div><div class=page-separator><hr></div><div id=webmentions></div><div class=related><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code><ul role=menubar id=article-list><li role=none class=h-entry><p class="p-author h-card hidden">Victoria Drake</p><img class="u-photo hidden" alt="photo of the author" id=author-img src=/img/victoria_headshot.jpg>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/how-to-do-twice-as-much-with-half-the-keystrokes-using-.bashrc/>How to do twice as much with half the keystrokes using `.bashrc`</a><p class=e-content>An overview of time-saving aliases, functions, and creating a useful Bash prompt.</p><p class=metadata><a class="tag button" href=/tags/linux/>linux</a>
☕️ ☕️
&nbsp;7 min read
<time class="hidden dt-published">2019-08-21 09:17:02 -0400 -0400</time></p></li><li role=none class=h-entry><p class="p-author h-card hidden">Victoria Drake</p><img class="u-photo hidden" alt="photo of the author" id=author-img src=/img/victoria_headshot.jpg>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/bash-and-shell-expansions-lazy-list-making/>Bash and shell expansions: lazy list-making</a><p class=e-content>A tour of brace expansion, shell parameter expansions, and playing with substrings in Bash.</p><p class=metadata><a class="tag button" href=/tags/terminal/>terminal</a>
☕️
&nbsp;5 min read
<time class="hidden dt-published">2019-11-18 07:07:24 -0500 -0500</time></p></li><li role=none class=h-entry><p class="p-author h-card hidden">Victoria Drake</p><img class="u-photo hidden" alt="photo of the author" id=author-img src=/img/victoria_headshot.jpg>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/a-cron-job-that-could-save-you-from-a-ransomware-attack/>A cron job that could save you from a ransomware attack</a><p class=e-content>How a simple scheduled job can help you quickly recover from ransomware.</p><p class=metadata><a class="tag button" href=/tags/cybersecurity/>cybersecurity</a>
☕️ ☕️
&nbsp;7 min read
<time class="hidden dt-published">2019-11-13 08:27:31 -0400 -0400</time></p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div><footer class=container><div class="markdown bio h-card p-author"><strong><a href=https://victoria.dev/ class="u-url p-name">Victoria Drake</a></strong><figure class="profile title-avatar u-photo"><img src=/img/victoria_headshot.jpg alt="Victoria's headshot"></figure><p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award three years in a row from the freeCodeCamp non-profit, and is a recognized Distinguished Author on the DEV.to developer platform. She writes about software development, cybersecurity, and building happy and productive technical teams.</p><p><a href=/about>about</a> - <a href=mailto:hello@victoria.dev>email</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></div></footer></main><script src=/js/webmention.min.js data-wordcount=42 async></script><nav aria-label="Victoria.dev menu for mobile" id=menu-mobile><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/img/bookmark.svg alt="home page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/img/quote.svg alt="blog icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/img/profile.svg alt="about page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/coffee/><img src=/img/coffee.svg alt="coffee icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/img/book.svg alt="bookshelf icon" height=18px class=filter-icon></a></li></ul></nav></body></html>