<!doctype html><html lang=en-us><head><head><meta charset=utf-8><meta name=mobile-web-app-capable content="yes"><meta name=viewport content="width=device-width,initial-scale=1"><title>victoria.dev</title><meta name=monetization content="$ilp.uphold.com/pBRfRwg2EJAe"><link rel="shortcut icon" href=https://victoria.dev/favicon.ico><link rel=icon type=image/png href=https://victoria.dev/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://victoria.dev/favicon-16x16.png sizes=16x16><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=me href=https://github.com/victoriadrake><link rel=me href=https://twitter.com/victoriadotdev><link rel=me href=https://mastodon.technology/@victoria><link rel=stylesheet href=https://victoria.dev/css/style.css crossorigin=anonymous media=screen><link rel=webmention href=https://webmention.io/victoria.dev/webmention><link rel=pingback href=https://webmention.io/victoria.dev/xmlrpc><meta property="og:url" content="https://victoria.dev/"><meta property="og:title" content="victoria.dev"><meta property="og:site_name" content="victoria.dev"><meta property="og:type" content="website"><meta name=twitter:title content="victoria.dev"></head></head><body><header role=banner><nav aria-label="Victoria.dev main menu" id=menu><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/icon/bookmark.svg alt="home page icon" height=18px class=filter-icon>&nbsp;hello</a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/icon/quote.svg alt="blog icon" height=18px class=filter-icon>&nbsp;blog</a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/icon/profile.svg alt="about page icon" height=18px class=filter-icon>&nbsp;about</a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/icon/book.svg alt="bookshelf icon" height=18px class=filter-icon>&nbsp;bookshelf</a></li></ul></nav><nav aria-label="Victoria.dev menu for mobile" id=menu-mobile><ul role=menubar><li role=none class=menu-item><a role=menuitem href=/><img src=/icon/bookmark.svg alt="home page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/blog/><img src=/icon/quote.svg alt="blog icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/about/><img src=/icon/profile.svg alt="about page icon" height=18px class=filter-icon></a></li><li role=none class=menu-item><a role=menuitem href=/bookshelf/><img src=/icon/book.svg alt="bookshelf icon" height=18px class=filter-icon></a></li></ul></nav></header><main aria-role=main><div class=container><div id=cover-image><img class=u-photo src=https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/cover.png alt="cover image"></div><article class=h-entry><h1 class=p-name>Deceptively simple search-and-replace across multiple files</h1><p class=subtitle>How to interactively search-and-replace across many files with just two commands, thanks to Vim.</p><span><a class="p-category tag button" href=/tags/terminal/>terminal
</a>&nbsp;
<a class="p-category tag button" href=/tags/linux/>linux
</a>&nbsp;</span>
<span rel=author class="p-author h-card"><img class="u-photo hidden" src=/img/victoria_headshot.jpg>
<span class="p-name hidden" rel=me>Victoria Drake</span></span><p class=metadata id=date><time class="hidden dt-published">2020-08-25 04:48:39 -0600 -0600</time>
<a class=u-url href=https://victoria.dev/blog/deceptively-simple-search-and-replace-across-multiple-files/>August 25, 2020</a>
<span class=dt-updated>&nbsp;<em>Updated: Jun 30, 2021</em></span>
<span>&nbsp;2 min read</span></p></p><div class=page-separator><hr></div><div class="markdown e-content"><p>While a multitude of methods exist to search for and replace words in a single file, what do you do when you&rsquo;ve got a string to update across multiple unrelated files, all with different names? You harness the power of command line tools, of course!</p><p>First, you&rsquo;ll need to <code>find</code> all the files you want to change. Stringing together what are effectively search queries for <code>find</code> is really only limited by your imagination. Here&rsquo;s a simple example that finds Python files:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>find . -name <span class=s1>&#39;*.py&#39;</span>
</code></pre></div><p>The <code>-name</code> test searches for a pattern, such as all files ending in <code>.py</code>, but <code>find</code> can do a lot more with other test conditions, including <code>-regex</code> tests. Run <code>find --help</code> to see the multitude of options.</p><p>Further tune your search by using <code>grep</code> to get only the files that contain the string you want to change, such as by adding:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>grep -le <span class=s1>&#39;\&lt;a whale\&gt;&#39;</span>
</code></pre></div><p>The <code>-l</code> option gives you just the file names for all files containing a pattern (denoted with <code>-e</code>) that match &ldquo;a whale&rdquo;.</p><p>Using Vim&rsquo;s impressive <code>:bufdo</code> lets you run the same command across multiple buffers, interactively working with all of these files without the tedium of opening, saving, and closing each file, one at a time.</p><p>Let&rsquo;s plug your powerful <code>find</code>+<code>grep</code> results into Vim with:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>vim <span class=sb>`</span>find . -name <span class=s1>&#39;*.py&#39;</span> <span class=se>\
</span><span class=se></span>-exec grep -le <span class=s1>&#39;\&lt;a whale\&gt;&#39;</span> <span class=o>{}</span> <span class=se>\;</span><span class=sb>`</span>
</code></pre></div><p>Using backtick-expansion to pass our search to Vim opens up multiple buffers ready to go. (Do <code>:h backtick-expansion</code> in Vim for more.) Now you can apply the Vim command <code>:bufdo</code> to all of these files and perform actions such as interactive search-and-replace:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> %<span class=nx>s</span><span class=sr>/a whale/</span><span class=nx>a</span> <span class=nx>bowl</span> <span class=nx>of</span> <span class=nx>petunias</span>/<span class=nx>gce</span><span class=err>
</span></code></pre></div><p>The <code>g</code> for &ldquo;global&rdquo; will change occurrences of the pattern on all lines. The <code>e</code> will omit errors if the pattern is not found. The <code>c</code> option makes this interactive; if you&rsquo;re feeling confident, you can omit it to make the changes without reviewing each one.</p><p>If one of the patterns contains a <code>/</code> character, you can substitute the separator in the above command to make it more readable. Vim will assume the character following the <code>%s</code> is the separator, so for example:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> %<span class=nx>s_a</span> <span class=nx>whale_a</span> <span class=nx>bowl</span> <span class=nx>of</span> <span class=nx>peonies</span>/<span class=nx>petunias_gce</span><span class=err>
</span></code></pre></div><p>When you&rsquo;ve finished going through all the buffers, save all the work you&rsquo;ve completed with:</p><div class=highlight><pre class=chroma><code class=language-vim data-lang=vim><span class=p>:</span><span class=nx>bufdo</span> <span class=nx>wq</span><span class=p>!</span><span class=err>
</span></code></pre></div><p>Then bask in the glory of your saved time and effort.</p></div><a class=hidden href=https://brid.gy/publish/twitter></a><a class=hidden href=https://brid.gy/publish/mastodon></a><data class=p-bridgy-omit-link value=false></data></article><div id=up-container><a href=# id=up>v</a></div><hr><div id=webmentions></div><div class=related><code class=language-sql data-lang=sql>SELECT TOP 3 * FROM Related;</code><ul role=menubar id=article-list><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/command-line-tricks-for-managing-your-messy-open-source-repository/>Command line tricks for managing your messy open source repository</a><p class="p-summary e-content">A handy toolbox for the terminal to help open source maintainers make their projects sparkle.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/terminal/>terminal</a>
&nbsp;5 min read
<time class="hidden dt-published">2020-02-17 08:05:06 -0500 -0500</time></p></li><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/create-a-self-hosted-chat-service-with-your-own-matrix-server/>Create a self-hosted chat service with your own Matrix server</a><p class="p-summary e-content">A speed-run introduction to Matrix via Dendrite.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/privacy/>privacy</a>
&nbsp;6 min read
<time class="hidden dt-published">2021-02-15 01:38:07 -0500 -0500</time></p></li><li role=none class=h-entry><a rel=author class="p-author h-card hidden" href=https://victoria.dev/>Victoria Drake</a>
<a role=menuitem class="article-link u-url p-name" href=https://victoria.dev/blog/bash-and-shell-expansions-lazy-list-making/>Bash and shell expansions: lazy list-making</a><p class="p-summary e-content">A tour of brace expansion, shell parameter expansions, and playing with substrings in Bash.</p><p class=metadata><a class="p-category tag button" href=https://victoria.dev/tags/terminal/>terminal</a>
&nbsp;5 min read
<time class="hidden dt-published">2019-11-18 07:07:24 -0500 -0500</time></p></li></ul><div class=page-separator><p class=back-link><a href=/blog>&lt;&lt; Back to blog</a></p></div></div></div></main><footer><div class="h-card row bio" rel=author><div class=markdown id=card><figure class=profile><img class=u-photo alt="Victoria Drake" src=/img/victoria_headshot.jpg></figure><h1 class=p-name>Victoria Drake</h1></address><p class=p-note><p>Victoria Drake is a Director of Engineering in Washington, DC. She is a core maintainer and co-author for the Open Web Application Security Project (OWASP) Web Security Testing Guide. She earned the annual Top Contributor award three years in a row from the freeCodeCamp non-profit, and was recognized two years in a row as a Distinguished Author on the DEV.to developer platform. She writes and educates programmers and business leaders about cybersecurity, software development, and building happy and productive technical teams.</p><p><a href=/about>about</a> - <a href=/contact>contact</a> - <a href=https://github.com/victoriadrake>github</a> - <a href=https://twitter.com/victoriadotdev>twitter</a> - <a href=https://www.linkedin.com/in/victoriadotdev/>linkedin</a></p></p></div></div></footer><script src=/js/webmention.min.js data-wordcount=100 async></script></body></html>